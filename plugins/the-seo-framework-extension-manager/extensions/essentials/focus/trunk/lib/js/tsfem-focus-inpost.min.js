'use strict';window.tsfem_e_focus_inpost=function(e){const t=tsfem_e_focusInpostL10n,n="#tsfem-e-focus-analysis-notification-area";let s={},a={},o={};const l=e=>/.*\[[0-9]+\]/.exec(e)[0]||"",d=(e,t)=>`${e}[${t}]`,r=(e,t)=>document.getElementById(`${e}[${t}]`),c=e=>(Object.keys(e).sort((e,t)=>Object.keys(e)[0]-Object.keys(t)[0]),e),f=(e,t)=>{if(!e||e!==Object(e))return;let n=s;t=!!t;let a,i;for(let s in e)for(let o in a=e[s],n[s]||(n[s]={}),a)if(i=a[o],n[s][i]||(n[s][i]=[]),t){let e=Object.values(n[s][i]);if(-1<e.indexOf(o))continue;n[s][i].push(o)}else n[s][i]=n[s][i].filter(e=>e!==o);s=n},u=e=>{const t=s;let n=a,i={},o=!1,l="",d=[];const r=e=>{i=t[e],o=!1,l="",d=[],"undefined"!=typeof i.dominate&&i.dominate.forEach(e=>{document.querySelector(e)&&(o=!0,l=e)}),o||"undefined"==typeof i.append||i.append.forEach(e=>{document.querySelector(e)&&d.push(e)}),o?n[e]=[l]:d.length?n[e]=d:c(e)},c=e=>{delete n[e]};if(e)"undefined"==typeof t[e]?c(e):r(e);else{for(var f in t)r(f)}a=n};let y={};const p=n=>{let s=l(n.id),i=`e_focus_pw_${n.dataset.assessmentType}_${s}`,o=n.querySelector(".tsfem-e-focus-assessment-rating");if(tsfem_worker.isWorkerBusy(i))return i in y&&clearTimeout(y[i]),void(y[i]=setTimeout(()=>p(n),2e3));delete y[i],tsfem_worker.occupyWorker(i),tsfem_inpost.setIconClass(o,"loading");let d,r=B(s).get("inflections"),c=B(s).get("synonyms"),f=e(n).data("scores"),u=0,h=0,v=0,x=0,b=0,k=f.assessment.regex;k!==Object(k)&&(k=[k]);const _=()=>{let e=f.scoring,t=0,s=0;const a=(e,t)=>t>e?e:t,i=(e,t)=>Math.floor(t/e.per)*e.score,l=(e,t)=>t*(e/100),d=(e,t)=>100*(t/e),r=(e,t)=>t/e.threshold*f.maxScore;switch(e.type){case"n":u&&(s+=i(e.keyword,a(e.keyword.max,u))),h&&(s+=i(e.synonym,a(e.synonym.max,h)));break;case"p":b&&(v&&(t+=d(b,l(e.keyword.weight,v))),x&&(t+=d(b,l(e.synonym.weight,x)))),s=r(e,t);}let c=document.querySelector(`input[name="${n.id}"]`);c&&(c.value=s);let y=n.querySelector(".tsfem-e-focus-assessment-description"),p=g(f.phrasing,s);y.innerHTML===p?(tsfem_inpost.setIconClass(o,m(f.rating,s)),y.style.opacity="1",y.style.willChange="auto"):(y.style.willChange="contents, opacity",y.style.opacity="0",y.innerHTML=p,tsfem_inpost.setIconClass(o,m(f.rating,s)),tsfem_inpost.fadeIn(y),y.style.willChange="auto")},w=()=>{let e=document.querySelector(`input[name="${n.id}"]`),s=n.querySelector(".tsfem-e-focus-assessment-description"),a=t.i18n.parseFailure;s.innerHTML===a?(tsfem_inpost.setIconClass(o,m(-1,-1)),s.style.opacity="1",s.style.willChange="auto"):(s.style.willChange="contents, opacity",s.style.opacity="0",s.innerHTML=a,tsfem_inpost.setIconClass(o,m(-1,-1)),tsfem_inpost.fadeIn(s),s.style.willChange="auto")};tsfem_inpost.promiseLoop(a[f.assessment.content],e=>new Promise((n,s)=>{let a=document.querySelector(e);return d="undefined"==typeof a.value?"":a.value,d.length||(d=a.innerHTML),d.length?void setTimeout(async()=>{await(tsfem_worker.getWorker(i)||tsfem_worker.spawnWorker(t.scripts.parserWorker,i)),tsfem_worker.tellWorker(i,{regex:k,inflections:r,synonyms:c,content:d,assess:{getCharCount:"p"===f.scoring.type}}).then(e=>{u=e.inflectionCount,h=e.synonymCount,v=e.inflectionCharCount,x=e.synonymCharCount,b=e.contentCharCount,n()}).catch(()=>{s()})}):n()}),5,3e4).then(()=>{_(),tsfem_worker.freeWorker(i)}).catch(()=>{w(),tsfem_worker.despawnWorker(i)})},g=(e,t)=>{let n;for(let s in e=c(e),e)if(isFinite(s)&&!isNaN(parseFloat(s)))if(s<=t)n=e[s];else break;return n||e[Object.keys(e)[0]]||""},m=(e,t)=>{let n=g(e,t).toString(),s={"-1":"error",0:"unknown",1:"bad",2:"warning",3:"okay",4:"good"};return s?.[n]||s["-1"]},h=e=>{let s=r(e,"keyword").value,a=r(e,"lexical_form");if(!a)return;P(e).to("loading");const i=n=>{const s=r(e,"lexical_selector"),i=r(e,"lexical_data");let o=Object.values(JSON.parse(t.defaultLexicalForm)||[]);n.length&&(n.forEach(e=>{e.inflection&&e.category&&o.push({value:e.inflection,category:e.category,name:`${e.category}: ${e.inflection}`})}),w(e).to("enabled"));let l=o.length&&JSON.stringify(o)||t.defaultLexicalForm;a.value="",i&&(i.value=l),s&&(x(e,l),s.disabled=!1,s.selectedIndex=0)};((e,s)=>tsfem_inpost.doAjax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_e_focus_get_lexicalforms",nonce:t.nonce,post_ID:tsfem_inpost.postID,args:{keyword:s,language:t.language}},timeout:15e3,async:!0},{noticeArea:n,premium:!0}))(e,s).then(e=>{i(e.forms)}).catch(()=>{v(e,"lexical")}).finally(()=>{P(e).to("edit")})},v=(e,n)=>{const s=()=>{const n=r(e,"lexical_form"),s=r(e,"lexical_selector"),a=r(e,"lexical_data");n&&(n.value=""),a&&(a.value=t.defaultLexicalForm),s&&(s.disabled=!0,s.selectedIndex=0,s.dataset.prev=0,x(e,t.defaultLexicalForm)),P(e).to("unchecked")},a=()=>{const t=r(e,"definition_dropdown"),n=r(e,"definition_selection");t&&(t.selectedIndex=0,t.innerHTML="",document.querySelector(`[data-for="${t.id}"]`).innerHTML=""),n&&(n.value=""),B(e).clearCache()},i=()=>{const t=r(e,"inflections")?.querySelector(".tsfem-e-focus-subject-selection"),n=r(e,"inflection_data"),s=r(e,"active_inflections");t&&(t.innerHTML=""),n&&(n.value=""),s&&(s.value=""),B(e).clearCache("inflections")},o=()=>{const t=r(e,"synonyms")?.querySelector(".tsfem-e-focus-subject-selection"),n=r(e,"synonym_data"),s=r(e,"active_synonyms");t&&(t.innerHTML=""),n&&(n.value=""),s&&(s.value=""),B(e).clearCache("synonyms"),tsfem_inpost.isPremium&&H(e)},l=()=>{r(e,"scores").querySelectorAll("input").forEach(e=>e.value=0)};switch(n){case"lexical":s(),a();break;case"definition":a();break;case"inflections":i();break;case"synonyms":o();break;case"ratings":l();break;default:s(),a(),i(),o(),l();}},x=(e,t)=>{let n=r(e,"lexical_selector");for(let s=n.options.length;s--;)n.remove(s);let s=document.createElement("option"),a=JSON.parse(t);if(a)for(let e in a)s=s.cloneNode(),s.value=tsfem_inpost.escapeStr(e),s.innerHTML=tsfem_inpost.escapeStr(a[e].name),n.appendChild(s)};let b={};const k=e=>{let s=e.data.idPrefix,a=r(s,"lexical_selector"),i=r(s,"lexical_form"),o=r(s,"lexical_data");const l=e=>{let s;return"inflections"===e?s="tsfem_e_focus_get_inflections":"synonyms"==e&&(s="tsfem_e_focus_get_synonyms"),s?tsfem_inpost.doAjax({method:"POST",url:ajaxurl,dataType:"json",data:{action:s,nonce:t.nonce,post_ID:tsfem_inpost.postID,args:{form:JSON.parse(o.value)?.[i.value],language:t.language}},timeout:15e3,async:!0},{noticeArea:n,premium:!0}):Promise.reject()},d=()=>l("inflections"),c=()=>l("synonyms"),f=e=>{i.value=e,a.value=e,a.selectedIndex=+e},u=()=>new Promise((e,n)=>t.languageSupported.inflections?void d().then(t=>{t.inflections.length?(v(s,"inflections"),r(s,"inflection_data").value=JSON.stringify([{inflections:t.inflections}]),e()):n()}).catch(t=>{switch(t){case 1100302:case 1100306:case 1100303:case 1100304:case 1100305:case 1100308:break;default:return void n();}let a=r(s,"keyword").value.toLowerCase(),l=i.value,d=o.value,c="",f=[];if(c=JSON.parse(d)?.[l].value.toLowerCase(),f.push(a),a!==c)f.push(c);else return void n();v(s,"inflections"),r(s,"inflection_data").value=JSON.stringify([{inflections:f}]),e()}):n()),y=()=>new Promise((e,n)=>t.languageSupported.synonyms?void c().then(t=>{t.synonyms.length?(v(s,"definition"),v(s,"synonyms"),r(s,"synonym_data").value=JSON.stringify(t.synonyms),e()):n()}).catch(e=>{1100202===e||1100205===e?(v(s,"definition"),v(s,"synonyms"),n()):n()}):n());(()=>{P(s).to("loading"),clearTimeout(b[s]),b[s]=setTimeout(()=>{a.dataset.prev==a.value?P(s).to("edit"):(f(a.value),+a.value?Promise.allSettled([u(),y()]).then(e=>{a.dataset.prev=a.value,"fulfilled"===e[0].status?"fulfilled"!==e[1].status&&(v(s,"definition"),v(s,"synonyms")):v(s,"inflections"),_(s),H(s),P(s).to("enabled, edit, checked, display")}).catch(()=>{f(a.dataset.prev||0),P(s).to("edit")}):(a.dataset.prev=a.value,P(s).to("unchecked, disabled, edit"),v(s,"definition"),v(s,"inflections"),v(s,"synonyms")))},1500)})()},_=e=>{let n=r(e,"synonym_data"),s=n.value&&JSON.parse(n.value)||{},a=r(e,"definition_dropdown"),i=r(e,"definition_selection"),o=a.cloneNode(!0);for(let t=o.options.length;t--;)o.remove(t);let l=document.createElement("option");for(let n=0;n<s.length;n++)l=l.cloneNode(),l.value=n,l.innerHTML=tsfem_inpost.escapeStr(s[n].example||t.i18n.noExampleAvailable),o.appendChild(l);a.innerHTML=o.innerHTML,a.value=i.value,a.selectedIndex=+i.value;let d=r(e,"definition_selector");a.options.length?(document.querySelector(`[data-for="${a.id}"]`)?.dispatchEvent(new CustomEvent("tsfem-e-focus-set-definition")),d.style.display=null):d.style.display="none"},w=t=>{const n=n=>{e(n).off("change.tsfemInpostLexical").on("change.tsfemInpostLexical",{idPrefix:t},k)},s=t=>{e(t).off("change.tsfemInpostLexical")};return{to:e=>{const a=r(t,"lexical_selector");if(a)switch(e){case"enabled":n(a);break;default:case"disabled":s(a);}}}},E=e=>{const t=r(e,"scores")?.querySelectorAll(".tsfem-e-focus-assessment-wrap");if(C(e).to("disabled"),!t?.length)S(e).to("error");else{S(e).to("enabled");for(let e=t.length;e--;)I(t[e]);K(e),C(e).to("enabled")}};let L={};const C=e=>({to:n=>{switch(n){case"disabled":e in L&&(clearInterval(L[e]),delete L[e]);break;case"enabled":C(e).to("disabled"),4999<t.settings.analysisInterval&&(L[e]=setInterval(()=>K(e),t.settings.analysisInterval));break;default:}}}),I=t=>{let n=l(t.id),s=r(n,"keyword").value;if(!s)return;let i,o,d,c,f;o=t.querySelector(".tsfem-e-focus-assessment-rating"),tsfem_inpost.setIconClass(o,"loading"),d=!0,f="undefined"!=typeof t.dataset.assess&&!+t.dataset.assess,i=e(t).data("scores"),i?.hasOwnProperty("assessment")&&"undefined"!=typeof a[i.assessment.content]&&(t.dataset.assess=1,W(t,i.assessment.content),d=!1),d?(tsfem_inpost.setIconClass(o,"unknown"),t.dataset.assess=0,c=document.getElementsByName(t.id),c?.[0]&&(c[0].value=0),tsfem_inpost.fadeOut(t,250)):f&&tsfem_inpost.fadeIn(t,250)},S=t=>{let n=e(r(t,"content")),s=[".tsfem-e-focus-scores-wrap",".tsfem-e-focus-no-keyword-wrap",".tsfem-e-focus-something-wrong-wrap"];const a=e=>{s.splice(s.indexOf(e),1),n.find(s.join(", ")).fadeOut(150,()=>{setTimeout(()=>{n.find(e).fadeIn(250)},150)})};return{to:e=>{let t;switch(e){case"disabled":t=".tsfem-e-focus-no-keyword-wrap";break;case"enabled":t=".tsfem-e-focus-scores-wrap";break;default:case"error":t=".tsfem-e-focus-something-wrong-wrap";}a(t)}}},P=e=>({to:t=>{const n=r(e,"subject_edit");if(!n)return;let s=document.querySelector(`label[for="${n.id}"]`),a=n.parentNode,i="tsfem-e-focus-edit-subject-button-wrap-disabled";t.split(",").forEach(e=>{switch(e.trim()){case"checked":n.checked||(n.checked=!0,n.dispatchEvent(new Event("change")));break;case"unchecked":n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change")));break;case"loading":s&&tsfem_inpost.setIconClass(s,"loading");break;case"edit":s&&tsfem_inpost.setIconClass(s,"edit");break;case"enabled":n.disabled=!1,a.classList.toggle(i,!1);break;case"disabled":n.disabled=!0,a.classList.toggle(i,!0);break;case"display":n.dispatchEvent(new CustomEvent("tsfem-e-focus-display-editor"));break;default:}})}}),T=()=>{const e=e=>{if(!tsfem_inpost.isActionableElement(e.target)){const t=r(l(e.target.closest(".tsfem-e-focus-collapse-wrap")?.id),"collapser");t&&(t.checked=!t.checked)}};document.querySelectorAll(".tsfem-e-focus-collapse-header").forEach(t=>{t.addEventListener("dblclick",e)})},q=()=>{let e={},n=1500,s=3,a={},i={},o=n/(100*s);!0&&(o*=1.175);const d=(e,t)=>{t.style.width=++a[e]/s+"%"},c=(e,t)=>{a[e]=0,t.style.width="0%"};let f=document.querySelectorAll(".tsfem-e-focus-keyword-entry");const u=e=>{let n=e.target,s=n.value.trim().replace(/[\s\t\r\n]+/g," ")||"",a=n.dataset.prev||"";if(e.target.value=s,s!==a){let a=l(e.target.id);return n.dataset.prev=s,v(a),P(a).to("disabled, edit"),C(a).to("disabled"),r(a,"scores").querySelectorAll(".tsfem-e-focus-assessment-description").forEach(e=>{e.style.opacity=0}),s.length?void(tsfem_inpost.isPremium&&t.languageSupported.any&&h(a),E(a)):(S(a).to("disabled"),void w(a).to("disabled"))}},y=t=>{let s=l(t.target.id),a=r(s,"content").querySelector(".tsfem-e-focus-content-loader-bar"),f=r(s,"collapser");f.checked&&(f.checked=!1,f.dispatchEvent(new Event("change"))),clearInterval(i[s]),clearTimeout(e[s]),c(s,a),i[s]=setInterval(()=>d(s,a),o),e[s]=setTimeout(()=>{clearInterval(i[s]),u(t),c(s,a)},n)};f.forEach(e=>{e.addEventListener("input",y),e.value.length||v(l(e.id))})},A=()=>{const t=(t,n)=>{const s=t.target;let a=0,i="",o=0,d="";n||=!1;const c=s?.dataset?.for;if(!c)return!1;const f=document.getElementById(c);if(!f)return!1;const u=l(c),y=r(u,"definition_selection");a=f.value,i=s.innerHTML;const p=()=>{s.innerHTML=d,f.value=o,y.value=o,+o!=+a&&(r(u,"active_synonyms").value="",H(u)),x()},g=()=>{f.blur(),f.style.display=null,e(s).fadeIn(300)},m=e=>{h(e.target),+o==+a&&x()||p()},h=e=>{o=e.value,d=e.options[e.selectedIndex].text},v=e=>{e.target!==f&&(e.target.closest(`#${f.id}`)||x())},x=()=>(_(),g(),!0),b=()=>{h(f),p()},k=()=>{f.addEventListener("blur",x),f.addEventListener("change",m),window.addEventListener("click",v),n&&b()},_=()=>{f.removeEventListener("blur",x),f.removeEventListener("change",m),window.removeEventListener("click",v)};n||(()=>{s.style.display="none",e(f).slideDown(200).trigger("focus")})(),setTimeout(k,10)},n=e=>{" "===e.key&&(e.preventDefault(),t(e))};let s={};const a=e=>{const t=l(e.target.id);s.hasOwnProperty(t)&&clearTimeout(s[t]),s[t]=setTimeout(()=>{const n=r(t,"edit"),s=r(t,"evaluate"),a=r(t,"collapser");a.checked?(e.target.checked=!0,s.style.display="none",s.style.opacity=0,n.style.display=null,n.style.opacity=1,a.checked=!1):e.target.checked?tsfem_inpost.fadeOut(s,150,{cb:()=>{tsfem_inpost.fadeIn(n),e.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(n,150,{cb:()=>{tsfem_inpost.fadeIn(s),e.target.checked=!1},promise:!1})},20)};document.querySelectorAll(".tsfem-e-focus-definition-editor").forEach(e=>{e.addEventListener("click",t),e.addEventListener("keypress",n),e.addEventListener("tsfem-e-focus-set-definition",e=>t(e,!0))}),document.querySelectorAll(".tsfem-e-focus-edit-subject-checkbox").forEach(e=>{e.addEventListener("change",a),e.addEventListener("tsfem-e-focus-display-editor",a)})};let j={};const M=()=>{const t=e=>(/\[([0-9]+)\]$/.exec(e)||"")[1],n=e=>{let n=[];r(e,"inflections").querySelectorAll("input:checked").forEach(e=>{n.push(t(e.id))}),r(e,"active_inflections").value=n.join(),B(e).clearCache("inflections"),K(e)},s=e=>{let n=[];r(e,"synonyms").querySelectorAll("input:checked").forEach(e=>{n.push(t(e.id))}),r(e,"active_synonyms").value=n.join(),B(e).clearCache("synonyms"),K(e)},a=e=>{const t=e.data.idPrefix,a=e.data.type,i=t+a;clearTimeout(j[i]),j[i]=setTimeout(()=>{"inflections"===a?n(t):"synonyms"===a?s(t):void 0},1500)},i=(t,n)=>{e(r(t,n)).find("input").off("change.tsfem-e-focus").on("change.tsfem-e-focus",{idPrefix:t,type:n},a)};let o="tsfem-e-focus-updated-subject.tsfem-e-focus";e(window).off(o).on(o,(e,t)=>{if(!t||!t.idPrefix)return;const a=t.idPrefix,o=r(a,"inflection_data"),l=r(a,"synonym_data"),c=r(a,"definition_selection"),f=r(a,"inflections"),u=r(a,"synonyms"),y=f.querySelector(".tsfem-e-focus-subject-selection"),p=u.querySelector(".tsfem-e-focus-subject-selection"),g=wp.template("tsfem-e-focus-subject-item");let m=o.value&&JSON.parse(o.value)?.[0].inflections||[],h=l.value&&JSON.parse(l.value)?.[+c.value].synonyms||[];y.style.opacity=0,p.style.opacity=0;let v=r(a,"active_inflections").value.split(","),x=r(a,"active_synonyms").value.split(","),b=r(a,"keyword").value.toLowerCase(),k="",_=d(a,"inflection"),w=!1;for(let n in m)w=m[n]===b,k+=g({id:d(_,n),value:m[n],checked:w||-1<v.indexOf(n+"")?"checked":"",disabled:w?"disabled":""});for(let n in y.innerHTML=k,k="",_=d(a,"synonym"),h)-1<m.indexOf(h[n])||(k+=g({id:d(_,n),value:h[n],checked:-1<x.indexOf(n+"")?"checked":""}));p.innerHTML=k,m.length?(f.style.display=null,tsfem_inpost.fadeIn(y)):f.style.display="none",h.length?(u.style.display=null,tsfem_inpost.fadeIn(p)):u.style.display="none",n(a),s(a),i(a,"inflections"),i(a,"synonyms")})},H=t=>{e(window).trigger("tsfem-e-focus-updated-subject",[{idPrefix:t}])};let O={};const B=e=>{O.hasOwnProperty(e)||(O[e]={inflections:void 0,synonyms:void 0});const t=()=>{let t=[],n=r(e,"keyword").value;const s=r(e,"active_inflections");if(s?.value){let n=r(e,"inflection_data").value,a=JSON.parse(n)?.[0].inflections;s.value.split(",").forEach(e=>{t.push(a[+e])})}return-1===t.indexOf(n)&&t.push(n),O[e].inflections=t},n=()=>{let t=[];const n=r(e,"active_synonyms"),s=r(e,"definition_selection");if(n?.value){let a=r(e,"synonym_data").value,o=JSON.parse(a)?.[+s.value].synonyms;n.value.split(",").forEach(e=>{t.push(o[+e])})}return O[e].synonyms=t},s=s=>{if(void 0!==O[e][s])return O[e][s];return"inflections"===s?t():"synonyms"===s?n():{inflections:t(),synonyms:n()}},a=t=>{t?delete O[e][t]:delete O[e]};return{get:e=>s(e),clearCache:e=>a(e)}},D=(e,t)=>{if("undefined"!=typeof o[e]){t||="unknown";for(let n=o[e].length;n--;)tsfem_inpost.setIconClass(document.getElementById(o[e][n]).querySelector(".tsfem-e-focus-assessment-rating"),t)}},W=(e,t)=>{let n=o;n&&n===Object(n)||(n=[]),n[t]&&n[t]===Object(n[t])||(n[t]=[]),e.id&&("undefined"==typeof a[t]?delete n[t][e.id]:0>n[t].indexOf(e.id)&&n[t].push(e.id)),o=n};let F={},U={};const N=t=>{const n=e=>{tsfem_inpost.promiseLoop(o[e],e=>{let t=l(e),n=r(t,"keyword"),s=n.value||"";if(!s.length)return;let a=document.getElementById(e),i=a.querySelector(".tsfem-e-focus-assessment-rating");tsfem_inpost.setIconClass(i,"loading"),setTimeout(()=>p(a),150)})},s=e=>{"undefined"==typeof o[e.data.type]||(clearTimeout(F[e.data.type]),!U[e.data.type]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll(`[data-assessment-type="${e.data.type}"] .tsfem-e-focus-assessment-rating`),"unknown"),0),U[e.data.type]=!0),F[e.data.type]=setTimeout(()=>{n(e.data.type),U[e.data.type]=!1},1500))},i=t=>{let n=R(t).get("names");e(a[t].join(", ")).off(n).on(n,{type:t},s)};if(t)"undefined"!=typeof a[t]&&i(t);else for(let e in a)"undefined"!=typeof a[e]&&i(e)};let G={};const K=t=>{t||=0,clearTimeout(G[t]),G[t]=setTimeout(()=>{if(t){const e=r(t,"scores")?.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assess=\"1\"]");e?.length?tsfem_inpost.promiseLoop(e,e=>p(e),150):S(t).to("error")}else{for(var n in a)e(a[n].join(", ")).trigger(R(n).get("trigger"))}},1e3)},R=e=>{const t=[`tsfem-e-focus.analysis-${e}`,`input.tsfem-e-focus-${e}`,`change.tsfem-e-focus-${e}`];return{get:e=>"names"===e?t.join(" "):"trigger"===e?t[0]:t}};let z;const J=()=>!!(z=document.getElementById("tsf-gutenberg-data-holder")),Q=new Map,V=t=>{const n=()=>`tsfem-focus-gbc-${t}`,s=()=>document.getElementById(n()),a=()=>{if(!s()){let e=document.createElement("div");e.id=n(),e.style.display="none",z.appendChild(e),r("create")}},i=()=>{let e="";switch(t){case"title":e="pageTitle";break;case"link":e="pageUrl";break;case"content":e="pageContent";break;default:}return e};Q.has(t)||Q.set(t,new Map);const o=e=>Q.get(t).has(e),l=e=>Q.get(t).set(e,!0),d=e=>Q.get(t).delete(e),r=async(e,n)=>{o(e)||(l(e),document.dispatchEvent(new CustomEvent(`tsfem-focus-gutenberg-${t}-store-${e}`,{bubbles:!1,cancelable:!1,detail:n||{}}))&&d(e))};return{getId:n,getElement:s,setup:()=>{a(t);let e=i();setTimeout(()=>{u(e),N(e)}),r("setup",{assessment:e})},create:a,empty:()=>{s().innerHTML=null,r("empty")},fill:e=>{s().innerHTML=e,r("fill",{data:e})},read:()=>s().innerHTML,triggerAnalysis:()=>{let t=i();e(`#${n()}`).trigger(R(t).get("trigger")),r("trigger-read",{assessment:t})}}},X=()=>{if(!J())return;const t=e(document),n=V("title"),s=V("link"),a=V("content");t.on("tsf-updated-gutenberg-title",(e,t)=>{n.fill(t),n.triggerAnalysis()}),n.setup("pageTitle"),t.on("tsf-updated-gutenberg-link",(e,t)=>{s.fill(t),s.triggerAnalysis()}),s.setup();const i=e=>{a.fill(e),a.triggerAnalysis()};t.on("tsf-updated-gutenberg-content",(e,t)=>{const n=lodash.debounce(i,500);let s=!1,a=wp.data.select("core/block-editor")||wp.data.select("core/editor");"function"==typeof a.isTyping&&(s=a.isTyping()),s?(D("pageContent","unknown"),n(t)):(n.cancel(),i(t))}),a.setup()},Y=()=>{const n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;(()=>{if("undefined"==typeof t.focusElements.pageUrl)return;let s=document.getElementById("edit-slug-box");if(!s)return;const a=()=>{const e=document.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assessment-type=url][data-assess=\"0\"]");e.length&&(u("pageUrl"),N("pageUrl"),e.forEach(e=>I(e)))};new n(()=>{a(),N("pageUrl"),e("#sample-permalink").trigger(R("pageUrl").get("trigger"))}).observe(s,{childList:!0,subtree:!0})})(),(()=>{if("undefined"==typeof tinyMCE||"function"!=typeof tinyMCE.on)return;let t=!1;tinyMCE.on("addEditor",n=>{if(t)return;if("content"!==n.editor.id)return;t=!0,u("pageContent"),N("pageContent");let s={},a=tinyMCE.get("content"),i=!1,o=!1;a.on("Dirty",()=>{o||(D("pageContent","unknown"),o=!0)}),a.on("GetContent",()=>{clearTimeout(s.GetContent),!i&&a.isDirty()&&(D("pageContent","loading"),i=!0,o=!1),s.GetContent=setTimeout(()=>{a.isDirty()||e("#content").trigger(R("pageContent").get("trigger")),i=!1,o=!1},1e3)})})})()},Z=()=>{tsfPost.l10n.states.isGutenbergPage?X():Y()},$=()=>{let e=document.querySelectorAll(".tsfem-e-focus-collapse-wrap");for(let n=e.length;n--;){let s=l(e[n].id),a=r(s,"keyword");if(a.value.length){if(a.dataset.prev=a.value,tsfem_inpost.isPremium&&t.languageSupported.any){let e=r(s,"lexical_selector");e.dataset.prev=e.value,1<e.length?w(s).to("enabled"):v(s,"lexical"),+e.value&&(P(s).to("enabled"),_(s),H(s))}E(s)}}},ee=()=>{if(Z(),t.hasOwnProperty("focusElements")&&(f(t.focusElements,!0),u(),N()),0===Object.keys(a).length){let e=document.getElementById("tsfem-e-focus-analysis-wrap")?.querySelector(".tsf-flex-setting-input");return void(e&&(e.innerHTML=wp.template("tsfem-e-focus-nofocus")()))}T(),q(),tsfem_inpost.isPremium&&t.languageSupported.any&&(A(),M()),$()},te=()=>{document.querySelectorAll(".tsfem-e-focus-enable-if-js").forEach(e=>{e.disabled=!1}),document.querySelectorAll(".tsfem-e-focus-disable-if-js").forEach(e=>{e.disabled=!0}),document.querySelectorAll(".tsfem-e-focus-requires-javascript").forEach(e=>{e.classList.remove("tsfem-e-focus-requires-javascript")})};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",te),document.body.addEventListener("tsf-ready",ee)}},{focusRegistry:s,activeFocusAreas:a,activeAssessments:o},{updateFocusRegistry:f,updateActiveFocusAreas:u,resetAnalysisChangeListeners:N,triggerAllAnalysis:K,analysisChangeEvents:R,getSubIdPrefix:l,getSubElementById:r,setAllRatersOf:D,blockEditorStore:V})}(jQuery),window.tsfem_e_focus_inpost.load();
