"use strict";window.tsfem_e_focus_inpost=function(e){const t=tsfem_e_focusInpostL10n,n="#tsfem-e-focus-analysis-notification-area",s=1500,a=500;let i={},o={},l={};const d=e=>/.*\[[0-9]+\]/.exec(e)[0]||"",r=(e,t)=>`${e}[${t}]`,c=(e,t)=>document.getElementById(`${e}[${t}]`),f=e=>(Object.keys(e).sort((e,t)=>Object.keys(e)[0]-Object.keys(t)[0]),e),u=(e,t)=>{if(!e||e!==Object(e))return;let n=i;t=!!t;let s,a;for(let i in e)for(let o in s=e[i],n[i]||(n[i]={}),s)if(a=s[o],n[i][a]||(n[i][a]=[]),t){let e=Object.values(n[i][a]);if(-1<e.indexOf(o))continue;n[i][a].push(o)}else n[i][a]=n[i][a].filter(e=>e!==o);i=n},y=e=>{let t=o,n={},s=!1,a="",l=[];const d=e=>{n=i[e],s=!1,a="",l=[],"undefined"!=typeof n.dominate&&n.dominate.forEach(e=>{document.querySelector(e)&&(s=!0,a=e)}),s||"undefined"==typeof n.append||n.append.forEach(e=>{document.querySelector(e)&&l.push(e)}),s?t[e]=[a]:l.length?t[e]=l:r(e)},r=e=>{delete t[e]};if(e)"undefined"==typeof i[e]?r(e):d(e);else{let e;for(e in i)d(e)}o=t};let p={};const g=n=>{let s=d(n.id),a=`e_focus_pw_${n.dataset.assessmentType}_${s}`,i=n.querySelector(".tsfem-e-focus-assessment-rating");if(tsfem_worker.isWorkerBusy(a))return a in p&&clearTimeout(p[a]),void(p[a]=setTimeout(()=>g(n),2e3));delete p[a],tsfem_worker.occupyWorker(a),tsfem_inpost.setIconClass(i,"loading");let l,r=D(s).get("inflections"),c=D(s).get("synonyms"),f=e(n).data("scores"),u=0,y=0,v=0,x=0,b=0,k=f.assessment.regex;k!==Object(k)&&(k=[k]);const _=e=>new Promise((n,s)=>{let i=document.querySelector(e);return l="undefined"==typeof i.value?"":i.value,l.length||(l=i.innerHTML),l.length?void setTimeout(async()=>{await(tsfem_worker.getWorker(a)||tsfem_worker.spawnWorker(t.scripts.parserWorker,a)),tsfem_worker.tellWorker(a,{regex:k,inflections:r,synonyms:c,content:l,assess:{getCharCount:"p"===f.scoring.type}}).then(e=>{u=e.inflectionCount,y=e.synonymCount,v=e.inflectionCharCount,x=e.synonymCharCount,b=e.contentCharCount,n()}).catch(e=>{tsf.l10n.states.debug&&void 0,s()})}):n()}),w=()=>{let e=f.scoring,t=0,s=0;const a=(e,t)=>t>e?e:t,o=(e,t)=>Math.floor(t/e.per)*e.score,l=(e,t)=>t*(e/100),d=(e,t)=>100*(t/e),r=(e,t)=>t/e.threshold*f.maxScore;switch(e.type){case"n":u&&(s+=o(e.keyword,a(e.keyword.max,u))),y&&(s+=o(e.synonym,a(e.synonym.max,y)));break;case"p":b&&(v&&(t+=d(b,l(e.keyword.weight,v))),x&&(t+=d(b,l(e.synonym.weight,x)))),s=r(e,t)}let c=document.querySelector(`input[name="${n.id}"]`);c&&(c.value=s);let p=n.querySelector(".tsfem-e-focus-assessment-description"),g=m(f.phrasing,s);p.innerHTML===g?(tsfem_inpost.setIconClass(i,h(f.rating,s)),p.style.opacity="1",p.style.willChange="auto"):(p.style.willChange="contents, opacity",p.style.opacity="0",p.innerHTML=g,tsfem_inpost.setIconClass(i,h(f.rating,s)),tsfem_inpost.fadeIn(p),p.style.willChange="auto")},E=()=>{let e=n.querySelector(".tsfem-e-focus-assessment-description"),s=t.i18n.parseFailure;e.innerHTML===s?(tsfem_inpost.setIconClass(i,h(-1,-1)),e.style.opacity="1",e.style.willChange="auto"):(e.style.willChange="contents, opacity",e.style.opacity="0",e.innerHTML=s,tsfem_inpost.setIconClass(i,h(-1,-1)),tsfem_inpost.fadeIn(e),e.style.willChange="auto")};tsfem_inpost.promiseLoop(o[f.assessment.content],_,5,3e4).then(()=>{w(),tsfem_worker.freeWorker(a)}).catch(()=>{E(),tsfem_worker.despawnWorker(a)})},m=(e,t)=>{let n;for(let s in e=f(e),e)if(isFinite(s)&&!isNaN(parseFloat(s)))if(s<=t)n=e[s];else break;return n||e[Object.keys(e)[0]]||""},h=(e,t)=>{let n=m(e,t).toString(),s={"-1":"error",0:"unknown",1:"bad",2:"warning",3:"okay",4:"good"};return s?.[n]||s["-1"]},v=e=>{let s=c(e,"keyword").value,a=c(e,"lexical_form");if(!a)return;P(e).to("loading");const i=n=>{const s=c(e,"lexical_selector"),i=c(e,"lexical_data");let o=Object.values(JSON.parse(t.defaultLexicalForm)||[]);n.length&&(n.forEach(e=>{e.inflection&&e.category&&o.push({value:e.inflection,category:e.category,name:`${e.category}: ${e.inflection}`})}),E(e).to("enabled"));let l=o.length&&JSON.stringify(o)||t.defaultLexicalForm;a.value="",i&&(i.value=l),s&&(b(e,l),s.disabled=!1,s.selectedIndex=0)},o=(e,s)=>tsfem_inpost.doAjax({method:"POST",url:ajaxurl,dataType:"json",data:{action:"tsfem_e_focus_get_lexicalforms",nonce:t.nonce,post_ID:tsfem_inpost.postID,args:{keyword:s,language:t.language}},timeout:15e3,async:!0},{noticeArea:n,premium:!0});o(e,s).then(e=>{i(e.forms)}).catch(()=>{x(e,"lexical")}).finally(()=>{P(e).to("edit")})},x=(e,n)=>{const s=()=>{const n=c(e,"lexical_form"),s=c(e,"lexical_selector"),a=c(e,"lexical_data");n&&(n.value=""),a&&(a.value=t.defaultLexicalForm),s&&(s.disabled=!0,s.selectedIndex=0,s.dataset.prev=0,b(e,t.defaultLexicalForm)),P(e).to("unchecked")},a=()=>{const t=c(e,"definition_dropdown"),n=c(e,"definition_selection");t&&(t.selectedIndex=0,t.innerHTML="",document.querySelector(`[data-for="${t.id}"]`).innerHTML=""),n&&(n.value=""),D(e).clearCache()},i=()=>{const t=c(e,"inflections")?.querySelector(".tsfem-e-focus-subject-selection"),n=c(e,"inflection_data"),s=c(e,"active_inflections");t&&(t.innerHTML=""),n&&(n.value=""),s&&(s.value=""),D(e).clearCache("inflections")},o=()=>{const t=c(e,"synonyms")?.querySelector(".tsfem-e-focus-subject-selection"),n=c(e,"synonym_data"),s=c(e,"active_synonyms");t&&(t.innerHTML=""),n&&(n.value=""),s&&(s.value=""),D(e).clearCache("synonyms"),tsfem_inpost.isPremium&&O(e)},l=()=>{c(e,"scores").querySelectorAll("input").forEach(e=>e.value=0)};"lexical"===n?(s(),a()):"definition"===n?a():"inflections"===n?i():"synonyms"===n?o():"ratings"===n?l():(s(),a(),i(),o(),l())},b=(e,t)=>{let n=c(e,"lexical_selector");for(let s=n.options.length;s--;)n.remove(s);let s=document.createElement("option"),a=JSON.parse(t);if(a)for(let e in a)s=s.cloneNode(),s.value=tsfem_inpost.escapeStr(e),s.innerHTML=tsfem_inpost.escapeStr(a[e].name),n.appendChild(s)};let k={};const _=e=>{let a=e.data.idPrefix,i=c(a,"lexical_selector"),o=c(a,"lexical_form"),l=c(a,"lexical_data");const d=e=>{let s;return"inflections"===e?s="tsfem_e_focus_get_inflections":"synonyms"==e&&(s="tsfem_e_focus_get_synonyms"),s?tsfem_inpost.doAjax({method:"POST",url:ajaxurl,dataType:"json",data:{action:s,nonce:t.nonce,post_ID:tsfem_inpost.postID,args:{form:JSON.parse(l.value)?.[o.value],language:t.language}},timeout:15e3,async:!0},{noticeArea:n,premium:!0}):Promise.reject()},r=()=>d("inflections"),f=()=>d("synonyms"),u=e=>{o.value=e,i.value=e,i.selectedIndex=+e},y=()=>new Promise((e,n)=>t.languageSupported.inflections?void r().then(t=>{t.inflections.length?(x(a,"inflections"),c(a,"inflection_data").value=JSON.stringify([{inflections:t.inflections}]),e()):n()}).catch(t=>{switch(t){case 1100302:case 1100306:case 1100303:case 1100304:case 1100305:case 1100308:break;default:return void n()}let s=c(a,"keyword").value.toLowerCase(),i=o.value,d=l.value,r="",f=[s];if(r=JSON.parse(d)?.[i]?.value.toLowerCase(),r&&s!==r)f.push(r);else return void n();x(a,"inflections"),c(a,"inflection_data").value=JSON.stringify([{inflections:f}]),e()}):n()),p=()=>new Promise((e,n)=>t.languageSupported.synonyms?void f().then(t=>{t.synonyms.length?(x(a,"definition"),x(a,"synonyms"),c(a,"synonym_data").value=JSON.stringify(t.synonyms),e()):n()}).catch(e=>{1100202===e||1100205===e?(x(a,"definition"),x(a,"synonyms"),n()):n()}):n()),g=()=>{P(a).to("loading"),clearTimeout(k[a]),k[a]=setTimeout(()=>{i.dataset.prev==i.value?P(a).to("edit"):(u(i.value),+i.value?Promise.allSettled([y(),p()]).then(e=>{i.dataset.prev=i.value,"fulfilled"!==e[0].status&&"fulfilled"!==e[1].status?(P(a).to("unchecked, disabled, edit"),x(a,"definition"),x(a,"inflections"),x(a,"synonyms")):("fulfilled"===e[0].status?"fulfilled"!==e[1].status&&(x(a,"definition"),x(a,"synonyms")):x(a,"inflections"),w(a),O(a),P(a).to("enabled, edit, checked, display"))}).catch(()=>{u(i.dataset.prev||0),P(a).to("edit")}):(i.dataset.prev=i.value,P(a).to("unchecked, disabled, edit"),x(a,"definition"),x(a,"inflections"),x(a,"synonyms")))},s)};g()},w=e=>{const n=c(e,"synonym_data"),s=n.value&&JSON.parse(n.value)||{},a=c(e,"definition_dropdown"),i=c(e,"definition_selection"),o=a.cloneNode(!0);for(let t=o.options.length;t--;)o.remove(t);let l=document.createElement("option");for(let n=0;n<s.length;n++)l=l.cloneNode(),l.value=n,l.innerHTML=tsfem_inpost.escapeStr(s[n].example||t.i18n.noExampleAvailable),o.appendChild(l);a.innerHTML=o.innerHTML,a.value=i.value,a.selectedIndex=+i.value;const d=c(e,"definition_selector");a.options.length?(document.querySelector(`[data-for="${a.id}"]`)?.dispatchEvent(new CustomEvent("tsfem-e-focus-set-definition")),d.style.display=null):d.style.display="none"},E=t=>{const n=n=>{e(n).off("change.tsfemInpostLexical").on("change.tsfemInpostLexical",{idPrefix:t},_)},s=t=>{e(t).off("change.tsfemInpostLexical")};return{to:e=>{const a=c(t,"lexical_selector");if(a)switch(e){case"enabled":n(a);break;default:case"disabled":s(a)}}}},L=e=>{const t=c(e,"scores")?.querySelectorAll(".tsfem-e-focus-assessment-wrap");if(I(e).to("disabled"),!t?.length)T(e).to("error");else{T(e).to("enabled");for(let e=t.length;e--;)S(t[e]);K(e),I(e).to("enabled")}},C=new Map,I=e=>({to:n=>{"disabled"===n?(clearInterval(C.get(e)),C.set(e,void 0)):"enabled"===n?4999<t.settings.analysisInterval&&(clearInterval(C.get(e)),C.set(e,setInterval(K,t.settings.analysisInterval,e))):void 0}}),S=t=>{let n=d(t.id),s=c(n,"keyword").value;if(!s)return;let a,i,l,r,f;i=t.querySelector(".tsfem-e-focus-assessment-rating"),tsfem_inpost.setIconClass(i,"loading"),l=!0,f="undefined"!=typeof t.dataset.assess&&!+t.dataset.assess,a=e(t).data("scores"),a?.hasOwnProperty("assessment")&&"undefined"!=typeof o[a.assessment.content]&&(t.dataset.assess=1,W(t,a.assessment.content),l=!1),l?(tsfem_inpost.setIconClass(i,"unknown"),t.dataset.assess=0,r=document.getElementsByName(t.id),r?.[0]&&(r[0].value=0),tsfem_inpost.fadeOut(t,250)):f&&tsfem_inpost.fadeIn(t,250)},T=t=>{let n=e(c(t,"content")),s=[".tsfem-e-focus-scores-wrap",".tsfem-e-focus-no-keyword-wrap",".tsfem-e-focus-something-wrong-wrap"];const a=e=>{s.splice(s.indexOf(e),1),n.find(s.join(", ")).fadeOut(150,()=>{setTimeout(()=>{n.find(e).fadeIn(250)},150)})};return{to:e=>{let t;switch(e){case"disabled":t=".tsfem-e-focus-no-keyword-wrap";break;case"enabled":t=".tsfem-e-focus-scores-wrap";break;default:case"error":t=".tsfem-e-focus-something-wrong-wrap"}a(t)}}},P=e=>({to:t=>{const n=c(e,"subject_edit");if(!n)return;let s=document.querySelector(`label[for="${n.id}"]`),a=n.parentNode,i="tsfem-e-focus-edit-subject-button-wrap-disabled";t.split(",").forEach(e=>{switch(e.trim()){case"checked":n.checked||(n.checked=!0,n.dispatchEvent(new Event("change")));break;case"unchecked":n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change")));break;case"loading":s&&tsfem_inpost.setIconClass(s,"loading");break;case"edit":s&&tsfem_inpost.setIconClass(s,"edit");break;case"enabled":n.disabled=!1,a.classList.toggle(i,!1);break;case"disabled":n.disabled=!0,a.classList.toggle(i,!0);break;case"display":n.dispatchEvent(new CustomEvent("tsfem-e-focus-display-editor"))}})}}),q=()=>{const e=e=>{if(!tsfem_inpost.isActionableElement(e.target)){const t=c(d(e.target.closest(".tsfem-e-focus-collapse-wrap")?.id),"collapser");t&&(t.checked=!t.checked)}};document.querySelectorAll(".tsfem-e-focus-collapse-header").forEach(t=>{t.addEventListener("dblclick",e)})},A=()=>{let e={},n=3,a=!0,i={},o={},l=s/(100*n);a&&(l*=1.175);const r=(e,t)=>{t.style.width=++i[e]/n+"%"},f=(e,t)=>{i[e]=0,t.style.width="0%"};let u=document.querySelectorAll(".tsfem-e-focus-keyword-entry");const y=e=>{let n=e.target,s=n.value.trim().replace(/[\s\t\r\n]+/g," ")||"",a=n.dataset.prev||"";if(e.target.value=s,s!==a){let a=d(e.target.id);return n.dataset.prev=s,x(a),P(a).to("disabled, edit"),I(a).to("disabled"),c(a,"scores").querySelectorAll(".tsfem-e-focus-assessment-description").forEach(e=>{e.style.opacity=0}),s.length?void(tsfem_inpost.isPremium&&t.languageSupported.any&&v(a),L(a)):(T(a).to("disabled"),void E(a).to("disabled"))}},p=t=>{let n=d(t.target.id),a=c(n,"content").querySelector(".tsfem-e-focus-content-loader-bar"),i=c(n,"collapser");i.checked&&(i.checked=!1,i.dispatchEvent(new Event("change"))),clearInterval(o[n]),clearTimeout(e[n]),f(n,a),o[n]=setInterval(r,l,n,a),e[n]=setTimeout(()=>{clearInterval(o[n]),y(t),f(n,a)},s)};u.forEach(e=>{e.addEventListener("input",p),e.value.length||x(d(e.id))})},j=()=>{const t=(t,n)=>{const s=t.target;let a=0,i="",o=0,l="";n||=!1;const r=s?.dataset?.for;if(!r)return!1;const f=document.getElementById(r);if(!f)return!1;const u=d(r),y=c(u,"definition_selection");a=f.value,i=s.innerHTML;const p=()=>{s.innerHTML=l,f.value=o,y.value=o,+o!=+a&&(c(u,"active_synonyms").value="",O(u)),k()},g=()=>{s.innerHTML=i,f.value=a},m=()=>{s.style.display="none",e(f).slideDown(200).trigger("focus")},h=()=>{f.blur(),f.style.display=null,e(s).fadeIn(300)},v=e=>{x(e.target),+o==+a&&k()||p()},x=e=>{o=e.value,l=e.options[e.selectedIndex].text},b=e=>{e.target!==f&&(e.target.closest(`#${f.id}`)||k())},k=()=>(E(),h(),!0),_=()=>{x(f),p()},w=()=>{f.addEventListener("blur",k),f.addEventListener("change",v),window.addEventListener("click",b),n&&_()},E=()=>{f.removeEventListener("blur",k),f.removeEventListener("change",v),window.removeEventListener("click",b)};n||m(),setTimeout(w,10)},n=e=>{" "===e.key&&(e.preventDefault(),t(e))};let s={};const a=e=>{const t=d(e.target.id);s.hasOwnProperty(t)&&clearTimeout(s[t]),s[t]=setTimeout(()=>{const n=c(t,"edit"),s=c(t,"evaluate"),a=c(t,"collapser");a.checked?(e.target.checked=!0,s.style.display="none",s.style.opacity=0,n.style.display=null,n.style.opacity=1,a.checked=!1):e.target.checked?tsfem_inpost.fadeOut(s,150,{cb:()=>{tsfem_inpost.fadeIn(n),e.target.checked=!0},promise:!1}):tsfem_inpost.fadeOut(n,150,{cb:()=>{tsfem_inpost.fadeIn(s),e.target.checked=!1},promise:!1})},20)};document.querySelectorAll(".tsfem-e-focus-definition-editor").forEach(e=>{e.addEventListener("click",t),e.addEventListener("keypress",n),e.addEventListener("tsfem-e-focus-set-definition",e=>t(e,!0))}),document.querySelectorAll(".tsfem-e-focus-edit-subject-checkbox").forEach(e=>{e.addEventListener("change",a),e.addEventListener("tsfem-e-focus-display-editor",a)})};let H={};const M=()=>{const t=e=>(/\[([0-9]+)\]$/.exec(e)||"")[1],n=e=>{let n=[];c(e,"inflections").querySelectorAll("input:checked").forEach(e=>{n.push(t(e.id))}),c(e,"active_inflections").value=n.join(),D(e).clearCache("inflections"),K(e)},a=e=>{let n=[];c(e,"synonyms").querySelectorAll("input:checked").forEach(e=>{n.push(t(e.id))}),c(e,"active_synonyms").value=n.join(),D(e).clearCache("synonyms"),K(e)},i=e=>{const t=e.data.idPrefix,i=e.data.type,o=t+i;clearTimeout(H[o]),H[o]=setTimeout(()=>{"inflections"===i?n(t):"synonyms"===i?a(t):void 0},s)},o=(t,n)=>{e(c(t,n)).find("input").off("change.tsfem-e-focus").on("change.tsfem-e-focus",{idPrefix:t,type:n},i)},l=(e,t)=>{if(!t||!t.idPrefix)return;const s=t.idPrefix,i=c(s,"inflection_data"),l=c(s,"synonym_data"),d=c(s,"definition_selection"),f=c(s,"inflections"),u=c(s,"synonyms"),y=f.querySelector(".tsfem-e-focus-subject-selection"),p=u.querySelector(".tsfem-e-focus-subject-selection"),g=wp.template("tsfem-e-focus-subject-item"),m=i.value&&JSON.parse(i.value)?.[0]?.inflections||[],h=l.value&&JSON.parse(l.value)?.[+d.value]?.synonyms||[];y.style.opacity=0,p.style.opacity=0;const v=c(s,"active_inflections").value.split(","),x=c(s,"active_synonyms").value.split(","),b=c(s,"keyword").value.toLowerCase();let k="",_=r(s,"inflection"),w=!1;for(let n in m)w=m[n].toLowerCase()===b,k+=g({id:r(_,n),value:m[n],checked:w||-1<v.indexOf(n+"")?"checked":"",disabled:w?"disabled":""});for(let n in y.innerHTML=k,k="",_=r(s,"synonym"),h)-1<m.indexOf(h[n])||(k+=g({id:r(_,n),value:h[n],checked:-1<x.indexOf(n+"")?"checked":""}));p.innerHTML=k,m.length?(f.style.display=null,tsfem_inpost.fadeIn(y)):f.style.display="none",h.length?(u.style.display=null,tsfem_inpost.fadeIn(p)):u.style.display="none",n(s),a(s),o(s,"inflections"),o(s,"synonyms")};let d="tsfem-e-focus-updated-subject.tsfem-e-focus";e(window).off(d).on(d,l)},O=t=>{e(window).trigger("tsfem-e-focus-updated-subject",[{idPrefix:t}])};let B={};const D=e=>{B.hasOwnProperty(e)||(B[e]={inflections:void 0,synonyms:void 0});const t=()=>{let t=[],n=c(e,"keyword").value;const s=c(e,"active_inflections");if(s?.value){const n=c(e,"inflection_data").value,a=JSON.parse(n)?.[0].inflections;s.value.split(",").forEach(e=>{t.push(a[+e])})}return-1===t.indexOf(n)&&t.push(n),B[e].inflections=t},n=()=>{let t=[];const n=c(e,"active_synonyms"),s=c(e,"definition_selection");if(n?.value){const a=JSON.parse(c(e,"synonym_data").value)?.[+s.value].synonyms;n.value.split(",").forEach(e=>{t.push(a[+e])})}return B[e].synonyms=t},s=s=>{if(void 0!==B[e][s])return B[e][s];return"inflections"===s?t():"synonyms"===s?n():{inflections:t(),synonyms:n()}},a=t=>{t?delete B[e][t]:delete B[e]};return{get:e=>s(e),clearCache:e=>a(e)}},F=(e,t)=>{if("undefined"!=typeof l[e]){t||="unknown";for(let n=l[e].length;n--;)tsfem_inpost.setIconClass(document.getElementById(l[e][n]).querySelector(".tsfem-e-focus-assessment-rating"),t)}},W=(e,t)=>{let n=l;n&&n===Object(n)||(n=[]),n[t]&&n[t]===Object(n[t])||(n[t]=[]),e.id&&("undefined"==typeof o[t]?delete n[t][e.id]:0>n[t].indexOf(e.id)&&n[t].push(e.id)),l=n};let U={},N={};const G=t=>{const n=e=>{tsfem_inpost.promiseLoop(l[e],e=>{let t=d(e),n=c(t,"keyword"),s=n.value||"";if(!s.length)return;let a=document.getElementById(e),i=a.querySelector(".tsfem-e-focus-assessment-rating");tsfem_inpost.setIconClass(i,"loading"),setTimeout(()=>g(a),150)})},a=e=>{const t=e.data.type;"undefined"==typeof l[t]||(clearTimeout(U[t]),!N[t]&&(setTimeout(()=>tsfem_inpost.setIconClass(document.querySelectorAll(`[data-assessment-type="${t}"] .tsfem-e-focus-assessment-rating`),"unknown"),0),N[t]=!0),U[t]=setTimeout(()=>{n(t),N[t]=!1},s))},i=t=>{let n=z(t).get("names");e(o[t].join(", ")).off(n).on(n,{type:t},a)};if(t)"undefined"!=typeof o[t]&&i(t);else for(let e in o)"undefined"!=typeof o[e]&&i(e)},R=new Map,K=t=>{t||=0,clearTimeout(R.get(t)),R.set(t,setTimeout(()=>{if(t){const e=c(t,"scores")?.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assess=\"1\"]");e?.length?tsfem_inpost.promiseLoop(e,e=>g(e),150):T(t).to("error")}else{let t;for(t in o)e(o[t].join(", ")).trigger(z(t).get("trigger"))}},1e3))},z=e=>{const t=[`tsfem-e-focus.analysis-${e}`,`input.tsfem-e-focus-${e}`,`change.tsfem-e-focus-${e}`];return{get:e=>"names"===e?t.join(" "):"trigger"===e?t[0]:t}};let J;const Q=()=>!!(J=document.getElementById("tsf-gutenberg-data-holder")),V=new Map,X=t=>{const n=()=>`tsfem-focus-gbc-${t}`,s=()=>document.getElementById(n()),a=()=>{i(t);let e=c();setTimeout(()=>{y(e),G(e)}),g("setup",{assessment:e})},i=()=>{if(!s()){let e=document.createElement("div");e.id=n(),e.style.display="none",J.appendChild(e),g("create")}},o=()=>{s().innerHTML=null,g("empty")},l=e=>{s().innerHTML=e,g("fill",{data:e})},d=()=>s().innerHTML,r=()=>{let t=c();e(`#${n()}`).trigger(z(t).get("trigger")),g("trigger-read",{assessment:t})},c=()=>{let e="";return"title"===t?e="pageTitle":"link"===t?e="pageUrl":"content"===t?e="pageContent":void 0,e};V.has(t)||V.set(t,new Map);const f=e=>V.get(t).has(e),u=e=>V.get(t).set(e,!0),p=e=>V.get(t).delete(e),g=async(e,n)=>{f(e)||(u(e),document.dispatchEvent(new CustomEvent(`tsfem-focus-gutenberg-${t}-store-${e}`,{bubbles:!1,cancelable:!1,detail:n||{}}))&&p(e))};return{getId:n,getElement:s,setup:a,create:i,empty:o,fill:l,read:d,triggerAnalysis:r}},Y=()=>{if(!Q())return;const t=e(document),n=X("title"),s=X("link"),i=X("content");t.on("tsf-updated-gutenberg-title",(e,t)=>{n.fill(t),n.triggerAnalysis()}),n.setup("pageTitle"),t.on("tsf-updated-gutenberg-link",(e,t)=>{s.fill(t),s.triggerAnalysis()}),s.setup();const o=e=>{i.fill(e),i.triggerAnalysis()},l=tsfem_inpost.debounce(e=>o(e),a);let d,r;t.on("tsf-updated-gutenberg-content",(e,t)=>{r??=wp.data.select("core/block-editor")||wp.data.select("core/editor"),d??="function"==typeof r.isTyping,d&&r.isTyping()?(F("pageContent","unknown"),l(t)):(l().cancel(),o(t))}),i.setup()},Z=()=>{(()=>{if("undefined"==typeof t.focusElements.pageUrl)return;let n=document.getElementById("edit-slug-box");if(!n)return;const s=()=>{const e=document.querySelectorAll(".tsfem-e-focus-assessment-wrap[data-assessment-type=url][data-assess=\"0\"]");e.length&&(y("pageUrl"),G("pageUrl"),e.forEach(e=>S(e)))};new MutationObserver(()=>{s(),G("pageUrl"),e("#sample-permalink").trigger(z("pageUrl").get("trigger"))}).observe(n,{childList:!0,subtree:!0})})(),(()=>{if("undefined"==typeof tinyMCE||"function"!=typeof tinyMCE.on)return;let t={editor:!1,excerpt:!1};tinyMCE.on("addEditor",n=>{switch(n.editor.id){case"content":case"excerpt":if(t[n.editor.id])return;break;default:return}y("pageContent"),G("pageContent");const s=tinyMCE.get(n.editor.id);let i={},o=!1,l=!1;s.on("Dirty",()=>{l||(F("pageContent","unknown"),o=!1,l=!0)}),s.on("GetContent",()=>{clearTimeout(i.GetContent),!o&&s.isDirty()&&(F("pageContent","loading"),o=!0,l=!1),i.GetContent=setTimeout(()=>{s.isDirty()||e(`#${n.editor.id}`).trigger(z("pageContent").get("trigger")),o=!1,l=!1},a)}),t[n.editor.id]=!0})})()},$=()=>{tsfPost.l10n.states.isGutenbergPage?Y():Z()},ee=()=>{let e=document.querySelectorAll(".tsfem-e-focus-collapse-wrap");for(let n=e.length;n--;){let s=d(e[n].id),a=c(s,"keyword");if(a.value.length){if(a.dataset.prev=a.value,tsfem_inpost.isPremium&&t.languageSupported.any){let e=c(s,"lexical_selector");e.dataset.prev=e.value,1<e.length?E(s).to("enabled"):x(s,"lexical"),+e.value&&(JSON.parse(c(s,"inflection_data").value)?.length||JSON.parse(c(s,"synonym_data").value)?.length)&&(P(s).to("enabled"),w(s),O(s))}L(s)}}},te=()=>{if($(),t.hasOwnProperty("focusElements")&&(u(t.focusElements,!0),y(),G()),0===Object.keys(o).length){let e=document.getElementById("tsfem-e-focus-analysis-wrap")?.querySelector(".tsf-flex-setting-input");return void(e&&(e.innerHTML=wp.template("tsfem-e-focus-nofocus")()))}q(),A(),tsfem_inpost.isPremium&&t.languageSupported.any&&(j(),M()),ee()},ne=()=>{document.querySelectorAll(".tsfem-e-focus-enable-if-js").forEach(e=>{e.disabled=!1}),document.querySelectorAll(".tsfem-e-focus-disable-if-js").forEach(e=>{e.disabled=!0}),document.querySelectorAll(".tsfem-e-focus-requires-javascript").forEach(e=>{e.classList.remove("tsfem-e-focus-requires-javascript")})};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",ne),document.body.addEventListener("tsf-ready",te)}},{focusRegistry:i,activeFocusAreas:o,activeAssessments:l},{updateFocusRegistry:u,updateActiveFocusAreas:y,resetAnalysisChangeListeners:G,triggerAllAnalysis:K,analysisChangeEvents:z,getSubIdPrefix:d,getSubElementById:c,setAllRatersOf:F,blockEditorStore:X})}(jQuery),window.tsfem_e_focus_inpost.load();
