'use strict';window.tsfem_e_monitor={nonce:tsfem_e_monitorL10n.nonce,i18n:tsfem_e_monitorL10n.i18n,rDataTimeout:tsfem_e_monitorL10n.remote_data_timeout,rCrawlTimeout:tsfem_e_monitorL10n.remote_crawl_timeout,showReadMore:function(a){let b=jQuery("#"+a.target.id+"-wrap"),c=jQuery("#"+a.target.id+"-content");b.remove(),c.slideDown(500)},requestCrawl:function(a){let b=jQuery(a.target);if(b.prop("disabled"))return;let c="tsfem-button-disabled tsfem-button-loading",d="#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax";b.addClass(c),b.prop("disabled",!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d),jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_crawl",nonce:tsfem_e_monitor.nonce,remote_crawl_timeout:tsfem_e_monitor.rCrawlTimeout},timeout:1e4,async:!0}).done(function(a){a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&console.log(a);let b=a&&a.data||void 0,c=a&&a.type||void 0;if(!b)tsfem.updatedResponse(d,0,tsfem.i18n.InvalidResponse);else{"undefined"!=typeof b.status.timeout&&(tsfem_e_monitor.rCrawlTimeout=b.status.timeout);let a=b.status.type,c=b.status.code,e=b.status.notice;"success"===a?(tsfem.updatedResponse(d,1,""),tsfem_ui.setTopNotice(c,e)):"yield_unchanged"===a?tsfem.updatedResponse(d,2,e):"requires_fix"===a?(tsfem_e_monitor.addRequiresFix(b.status.requires_fix),tsfem.updatedResponse(d,0,""),tsfem_ui.setTopNotice(c,e)):(tsfem.updatedResponse(d,0,""),tsfem_ui.setTopNotice(c,e))}}).fail(function(a,b,c){let e=tsfem.getAjaxError(a,b,c);tsfem.updatedResponse(d,0,e)}).always(function(){b.removeClass(c),b.prop("disabled",!1)})},fetchData:function(a){let b=jQuery(a.target);if(b.prop("disabled"))return;let c="tsfem-button-disabled tsfem-button-loading",d="#tsfem-e-monitor-issues-pane .tsfem-pane-header .tsfem-ajax";b.addClass(c),b.prop("disabled",!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);let e=document.getElementById("tsfem-e-monitor-last-crawled"),f=e.classList.contains("tsfem-success")?"tsfem-success":"tsfem-error";e.classList.remove("tsfem-success"),e.classList.remove("tsfem-error"),e.classList.add("tsfem-loading"),tsfem_e_monitor.setSettingsLoader(),jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_fetch",nonce:tsfem_e_monitor.nonce,remote_data_timeout:tsfem_e_monitor.rDataTimeout},timeout:15e3,async:!0}).done(function(a){a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&console.log(a);let b=a&&a.data||void 0,c=a&&a.type||void 0;if(!b||!b.status)tsfem.updatedResponse(d,0,tsfem.i18n.InvalidResponse);else{"undefined"!=typeof b.status.timeout&&(tsfem_e_monitor.rDataTimeout=b.status.timeout);let a=b.status.type,c=b.status.content,e=b.status.code,f=b.status.notice;if("success"===a){let a=c.issues,b=c.lc,e=c.settings;if("undefined"!=typeof e)for(let a in e)e.hasOwnProperty(a)&&tsfem_e_monitor.setSetting(a,e[a],!0);a.found?(jQuery(".tsfem-e-monitor-issues-wrap").empty().css("opacity",0).append(a.data.wrap).animate({opacity:1},{queue:!0,duration:250}),jQuery.each(a.data.info,function(a,b){setTimeout(function(){jQuery(b).appendTo(".tsfem-e-monitor-issues-wrap > div").css("opacity",0).animate({opacity:1},{queue:!1,duration:250})},250*a)})):jQuery(".tsfem-e-monitor-issues-wrap").empty().css("opacity",0).append(a.data).animate({opacity:1},{queue:!0,duration:1e3}),jQuery("#tsfem-e-monitor-last-crawled").replaceWith(jQuery(b).css("opacity",0)),jQuery("#tsfem-e-monitor-last-crawled").animate({opacity:1},{queue:!0,duration:1e3}),setTimeout(function(){tsfem.updatedResponse(d,1,f)},1e3),tsfTT.triggerReset()}else"yield_unchanged"===a?tsfem.updatedResponse(d,2,f):"requires_fix"===a?(tsfem_e_monitor.addRequiresFix(),tsfem.updatedResponse(d,0,""),tsfem_ui.setTopNotice(e,f)):(tsfem.updatedResponse(d,0,""),tsfem_ui.setTopNotice(e,f))}}).fail(function(a,b,c){let e=tsfem.getAjaxError(a,b,c);tsfem.updatedResponse(d,0,e)}).always(function(){document.body.contains(e)&&(e.classList.remove("tsfem-loading"),e.classList.add(f)),tsfem_e_monitor.unsetSettingsLoader(),b.removeClass(c),b.prop("disabled",!1)})},addRequiresFix:function(){0<jQuery(".tsfem-account-fix").length||1>jQuery(".tsfem-account-info").length||jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_get_requires_fix",nonce:tsfem_e_monitor.nonce},timeout:7e3,async:!0}).done(function(a){a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&console.log(a);let b=a&&a.data||void 0,c=a&&a.type||void 0;b&&b.html&&jQuery(b.html).insertAfter(".tsfem-account-info").hide().slideDown(500)}).fail(function(a,b,c){tsf.l10n.states.debug&&(console.log(a.responseText),console.log(c))})},setSettingsLoader:function(){let a=document.querySelectorAll(".tsfem-e-monitor-edit");for(let b=0;b<a.length;b++)a[b].classList.remove("tsfem-edit"),a[b].classList.remove("tsfem-dashicon-fadeout-3000"),a[b].classList.add("tsfem-loading")},unsetSettingsLoader:function(){let a=document.querySelectorAll(".tsfem-e-monitor-edit");for(let b=0;b<a.length;b++)tsfem_e_monitor.animateResetClicker(a[b])},setSetting:function(a,b,c){c=c||!1;let d,e=document.querySelector(".tsfem-e-monitor-settings-holder[data-option-id=\""+a+"\"]"),f=e&&e.querySelector(".tsfem-e-monitor-edit"),g="";if(!f)return void tsfem_ui.setTopNotice(1011800);"for"in f.dataset&&(g=f.dataset.for),d=g&&document.getElementById(g);d&&(d.value=b,f.innerHTML=d.options[d.selectedIndex].text,c&&tsfem_e_monitor.animateResetClicker(f))},animateResetClicker:function(a){a.classList.contains("tsfem-dashicon-fadeout-3000")||a.classList.contains("tsfem-edit")||(a.classList.remove("tsfem-loading"),a.classList.contains("tsfem-success")||a.classList.contains("tsfem-error")||a.classList.contains("tsfem-unknown")?(a.classList.add("tsfem-dashicon-fadeout-3000"),setTimeout(function(){a.classList.remove("tsfem-success"),a.classList.remove("tsfem-error"),a.classList.remove("tsfem-dashicon-fadeout-3000"),a.classList.add("tsfem-edit")},3e3)):a.classList.add("tsfem-edit"))},editSetting:function(a){let b,c,d=a.target,e=0,f="",g=0,h="",i="";if(d.classList.contains("tsfem-loading"))return!1;if("for"in d.dataset&&(b=d.dataset.for),!b)return!1;if(c=document.getElementById(b),!c)return!1;e=c.value,f=d.innerHTML;const j=function(){const a=function(){d.classList.remove("tsfem-loading"),d.classList.add("tsfem-error")},b=function(){d.classList.remove("tsfem-loading"),d.classList.add("tsfem-success")};r(),m();let c="#tsfem-e-monitor-cp-pane .tsfem-pane-header .tsfem-ajax",e=0,f=0,j="";tsfem.resetAjaxLoader(c),tsfem.setAjaxLoader(c),tsfem_e_monitor.setSettingsLoader(),d.innerHTML=h,jQuery.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_e_monitor_update",nonce:tsfem_e_monitor.nonce,option:i,value:g},timeout:15e3,async:!0}).done(function(c){c=tsf.convertJSONResponse(c),tsf.l10n.states.debug&&console.log(c);let d=c&&c.data||void 0,g=c&&c.type||void 0;if(!d||!g)j=tsfem.i18n.UnknownError,k(),a();else{let c=d.results&&d.results.code||void 0,g=d.results&&d.results.success||void 0;switch(j=d.results&&d.results.notice||void 0,g?b():a(),c){case 1010805:e=1;break;case 1010804:f=c,e=2;break;default:case 1010801:case 1010802:case 1010803:case 1019002:case 1010702:j=tsfem.i18n.UnknownError,f=c||!1,e=0;}if("undefined"!=typeof d.settings)for(let a in d.settings)d.settings.hasOwnProperty(a)&&tsfem_e_monitor.setSetting(a,d.settings[a],!1)}}).fail(function(b,c,d){k(),a(),j=tsfem.getAjaxError(b,c,d),tsfem_ui.setTopNotice(1011700),d&&tsfem_ui.setTopNotice(-1,"Thrown error: "+d)}).always(function(){tsfem.updatedResponse(c,e,j),f&&tsfem_ui.setTopNotice(f,""),tsfem_e_monitor.unsetSettingsLoader()})},k=function(){d.innerHTML=f,c.value=e},l=function(){jQuery(d).hide(),jQuery(c).slideDown(200).trigger("focus")},m=function(){jQuery(c).trigger("blur").hide(),jQuery(d).fadeIn(300)},n=function(a){let b=a.target;g=b.value,h=b.options[b.selectedIndex].text,i=b.name,g==e&&p()||j()},o=function(a){let b=jQuery(a.target).closest(c);1>b.length&&p()},p=function(){return r(),m(),!0},q=function(){c.addEventListener("blur",p),c.addEventListener("change",n),window.addEventListener("click",o)},r=function(){c.removeEventListener("blur",p),c.removeEventListener("change",n),window.removeEventListener("click",o)};l(),setTimeout(q,10)},a11yEditSetting:function(a){32==a.which&&(a.preventDefault(),tsfem_e_monitor.editSetting(a))},ready:function(a){a("#tsfem-e-monitor-privacy-readmore").on("click",tsfem_e_monitor.showReadMore),a("#tsfem-e-monitor-crawl-button").on("click",tsfem_e_monitor.requestCrawl),a("#tsfem-e-monitor-fetch-button").on("click",tsfem_e_monitor.fetchData),a(".tsfem-e-monitor-edit").on("click",tsfem_e_monitor.editSetting),a(".tsfem-e-monitor-edit").on("keypress",tsfem_e_monitor.a11yEditSetting)}},jQuery(tsfem_e_monitor.ready);
