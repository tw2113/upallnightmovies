"use strict";window.tsfem_inpost=function(a){const b=tsfem_inpostL10n.post_ID,c=tsfem_inpostL10n.nonce,d=tsfem_inpostL10n.isPremium,e=tsfem_inpostL10n.locale,f=tsfem_inpostL10n.i18n;let g=!1,h=!1;const i=d=>{const e=(a,b)=>{const c=document.querySelector(b),d=c.querySelectorAll(".tsf-notice, .notice"),e=200,f={duration:e,iterations:1};c.style.willChange="contents",1<d.length&&(c.style.maxHeight=`${c.getBoundingClientRect().height}px`,c.style.overflow="hidden",Array.from(d).slice(0,d.length-1).forEach(a=>{a.style.transformOrigin="bottom",a.animate([{transform:"scaleY(1)",maxHeight:`${a.clientHeight}px`,opacity:1},{transform:"scaleY(0)",maxHeight:0,opacity:0}],f),setTimeout(()=>a.remove(),e)}));const g=document.createElement("template");g.innerHTML=a,c.append(g.content);const i=c.lastChild;i.style.transformOrigin="bottom",i.animate([{transform:"scaleY(0)",maxHeight:0,opacity:1},{transform:"scaleY(1)",maxHeight:`${i.clientHeight}px`,opacity:1}],f),clearTimeout(h),h=setTimeout(()=>{c.style.maxHeight=null,c.style.overflow=null},e),tsf.triggerNoticeReset()},f=(d,e)=>{let f=a.Deferred(),g=e?1:0,h="";return a.ajax({method:"POST",url:ajaxurl,datatype:"json",data:{action:"tsfem_inpost_get_dismissible_notice",post_ID:b,nonce:c,"tsfem-notice-key":d,"tsfem-notice-has-msg":g},timeout:7e3}).done(a=>{a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&void 0;let b=a?.data,c=a?.type;if(!b||!c||"undefined"==typeof b.notice);else{let a=b.notice;if(g){const b=document.createElement("div");b.innerHTML=a,window.isRtl?b.querySelector("p")?.insertAdjacentHTML("beforebegin",`${e} `):b.querySelector("p")?.insertAdjacentHTML("beforeend",` ${e}`),a=b.innerHTML}h=a}}).fail(()=>{tsf.l10n.states.debug&&(void 0);let a=g?wp.template("tsfem-inpost-notice-error"):wp.template("tsfem-inpost-notice-5xx"),b=a({code:d,msg:e});h=b}).always(()=>{f.resolve(h)}),f.promise()};return{in:a=>{if(d){if(g)return void setTimeout(()=>{i(d).in(a)},500);g=!0;let b=d.type||"error",c=d.code||void 0,h=d.text||"";if(void 0===c)f(-1,h).always(b=>{e(b,a),g=!1});else if(""===h)f(c,"").always(b=>{e(b,a),g=!1});else{const d=wp.template(`tsfem-inpost-notice-${b}`);e(d({code:c,msg:h}),a),g=!1}}}}},j=(a,b,c)=>{tsf.l10n.states.debug&&(void 0);let d="";return d="abort"===c||"timeout"===c?f.TimeoutError:"Bad Request"===c?f.BadRequest:"Internal Server Error"===c?f.FatalError:"parsererror"===c?f.ParseError:f.UnknownError,d},k=(a,b)=>{if(a instanceof NodeList)return void a.forEach(a=>k(a,b));if(a&&!(!a instanceof Element)){["edit","loading","unknown","error","bad","warning","okay","good"].forEach(d=>{a.classList.remove(`tsfem-e-inpost-icon-${d}`),d===b&&a.classList.add(`tsfem-e-inpost-icon-${d}`)})}};var l={},m={};const n=(a,b,c,d)=>{var e=Number.parseFloat;if(!a||!a instanceof HTMLElement)return;a.style.willChange="opacity";let f=!1,g=!1;"function"==typeof c?(f=c,g=!0):"object"==typeof c&&(f=c?.cb||!1,g=c?.promise||!1),b||=250,d=!(void 0!==d)||d;let h,i,j,k=a.dataset.tsfemFadeId||"_"+Math.random().toString(22).substring(2,10)+Math.random().toString(22).substring(2,10),n=0;a.dataset.tsfemFadeId=k,"undefined"!=typeof l[k]&&(cancelAnimationFrame(l[k].frame),"show"===l[k].type?(a.style.opacity=1,a.style.display=null):(a.style.opacity=0,a.style.display="none"),delete l[k],"undefined"!=typeof m[k]&&m[k].resolve(),delete m[k]),g&&f&&(m[k]=new Promise,(()=>{m[k].then(()=>{delete m[k],f()})})(f)),l[k]={type:d?"show":"hide",frame:void 0},d?(a.style.display=null,a.style.opacity=0,h=c=>{i=void 0===i?c:i,j=(c-i)/b,n=+e(j).toPrecision(3),a.style.opacity=n,1<=n?(cancelAnimationFrame(l[k].frame),a.style.opacity=1,a.style.display=null,a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete l[k],g?m?.[k].resolve():f&&f()):l[k].frame=requestAnimationFrame(h)}):(a.style.display=null,a.style.opacity=1,h=c=>{i=void 0===i?c:i,j=(c-i)/b,n=+e(1-j).toPrecision(3),a.style.opacity=n,a.style.display=null,0>=n?(cancelAnimationFrame(l[k].frame),a.style.opacity=0,a.style.display="none",a.style.willChange="auto",delete a.dataset.tsfemFadeId,delete l[k],g?m?.[k].resolve():f&&f()):l[k].frame=requestAnimationFrame(h)}),l[k].frame=requestAnimationFrame(h)};return Object.assign({load:()=>{}},{postID:b,nonce:c,isPremium:d,locale:e,i18n:f},{isActionableElement:a=>!(!a instanceof HTMLElement)&&(a instanceof HTMLInputElement||a instanceof HTMLSelectElement||a instanceof HTMLLabelElement||a instanceof HTMLButtonElement||a instanceof HTMLTextAreaElement),escapeStr:(a,b)=>a.length?b?a.replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]):a.replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[a]):"",promiseLoop:(a,b,c,d=2e3)=>new Promise((e,f)=>{let g=a.length;if(!g)return e();const h=i=>{let j,k,l;d&&(k=setTimeout(()=>{clearTimeout(j),l=setTimeout(()=>{f()},250)},d)),j=setTimeout(()=>new Promise(async(c,d)=>{try{await b(a[i]),c()}catch(a){d()}}).then(()=>{if(d&&(clearTimeout(k),l)){if(i<g)return;clearTimeout(l)}++i===g?e():(j=null,h(i))}).catch(()=>{f()}),c)};h(0)}),doAjax:(b,c)=>new Promise((e,g)=>{let h,k=c.noticeArea,l=c.premium||!1;return l&&!d?g():void(tsf.l10n.states.debug&&void 0,a.ajax(b).done(a=>{a=tsf.convertJSONResponse(a),tsf.l10n.states.debug&&void 0;let b=a?.data,c=a?.type;if(!b||!c)return h={type:"error",code:-1,text:f.InvalidResponse},void g();let d=b?.results?.code,i=b?.results?.notice,j=b?.results?.type;d&&j&&(h={type:j,code:d,text:i}),"success"===c&&"data"in b?e(b.data):g(d)}).fail((a,b,c)=>{tsf.l10n.states.debug&&(void 0,void 0),h={type:"error",code:-1,text:j(a,b,c)},g()}).always(()=>{h&&i(h).in(k)}))}),setFlexNotice:i,getAjaxError:j,setIconClass:k,fadeOut:(a,b,c)=>{n(a,b,c,!1)},fadeIn:n,debounce:(a,b=0)=>{let c;return(...d)=>(clearTimeout(c),{timeoutId:c=setTimeout(()=>a(...d),b),cancel:()=>clearTimeout(c)})}})}(jQuery),window.tsfem_inpost.load();
