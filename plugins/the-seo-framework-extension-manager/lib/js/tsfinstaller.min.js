'use strict';window.tsfinstaller=function(a){var b=a(document);const c=c=>{wp.updates.addAdminNotice({id:"install-success",className:"notice-success is-dismissible",message:wp.updates.l10n.installedMsg.replace("%s",c.activateUrl+"&from=plugins")}),a("[data-slug=\""+c.slug+"\"]").removeClass("install-now updating-message").addClass("activate-now").attr({href:c.activateUrl+"&from=plugins","aria-label":wp.updates.l10n.activatePluginLabel.replace("%s",c.pluginName)}).text(wp.updates.l10n.activatePlugin),wp.a11y.speak(wp.updates.l10n.installedMsg,"polite"),b.trigger("tsfem-tsf-install-success",c)},d=c=>{let d=wp.updates.l10n.installFailed.replace("%s",c.errorMessage),e=a("[data-slug=\""+c.slug+"\"]"),f=e.data("name");if(wp.updates.isValidResponse(c,"install")&&!wp.updates.maybeHandleCredentialError(c,"install-plugin")){wp.updates.addAdminNotice({id:c.errorCode,className:"notice-error is-dismissible",message:d});let a=wp.updates.l10n.hasOwnProperty("pluginInstallNowLabel")?wp.updates.l10n.pluginInstallNowLabel:wp.updates.l10n.installNowLabel;e.removeClass("updating-message").text(wp.updates.l10n.installNow).attr("aria-label",a.replace("%s",f)),wp.a11y.speak(d,"assertive"),b.trigger("tsfem-tsf-install-error",c)}},e=()=>{if(!wp||!wp.updates)return;let e=wp.updates._addCallbacks;a("#plugin_install_from_iframe").on("click",function(b){let c,d=window.parent===window?null:window.parent;-1!==window.parent.location.pathname.indexOf("index.php")&&a(this).data("slug")===tsfinstallerL10n.slug&&(a.support.postMessage=!!window.postMessage,!1===a.support.postMessage||null===d||(b.preventDefault(),c={action:"install-plugin",data:{slug:a(this).data("slug")}},d.postMessage(JSON.stringify(c),window.location.origin)))}),a("#tsfem-tsf-tb").on("click",()=>{let f=!1;wp.updates._addCallbacks=(b,e)=>{if("install-plugin"===e&&tsfinstallerL10n.slug===b.slug){b.success=c,b.error=d;let e=a("[data-slug=\""+b.slug+"\"]");e.addClass("updating-message").attr("aria-label",wp.updates.l10n.pluginInstallingLabel.replace("%s",e.data("name"))).text(wp.updates.l10n.installing),f=!0}return b},a(window).on("message",b=>{let c;try{c=a.parseJSON(b.originalEvent.data)}catch(a){return}c&&"undefined"!=typeof c.action&&("install-plugin"===c.action?f=!1:f=!0)});let g,h;const i=()=>{wp.updates._addCallbacks=e,clearInterval(g),b.off(h,i)},j=()=>{f&&i()};h="wp-plugin-installing wp-plugin-install-error wp-plugin-install-success",a("body").one("thickbox:removed",()=>{g=setInterval(j,100),setTimeout(i,750)}),b.one(h,i)}),b.on("click","#tsfem-tsf-install",e=>{let f=a(e.target);f.hasClass("activate-now")||(e.preventDefault(),f.hasClass("updating-message")||f.hasClass("button-disabled")||(f.html()!==wp.updates.l10n.installing&&f.data("originaltext",f.html()),f.addClass("updating-message").attr("aria-label",wp.updates.l10n.pluginInstallingLabel.replace("%s",f.data("name"))).text(wp.updates.l10n.installing),wp.updates.shouldRequestFilesystemCredentials&&!wp.updates.ajaxLocked&&(wp.updates.requestFilesystemCredentials(e),b.on("credential-modal-cancel",()=>{f.removeClass("updating-message").text(wp.updates.l10n.installNow).attr("aria-label",wp.updates.l10n.installNowLabel.replace("%s",f.data("name"))),wp.a11y.speak(wp.updates.l10n.updateCancel,"polite")})),wp.updates.installPlugin({slug:f.data("slug"),pagenow:pagenow,success:c,error:d})))})};return{load:()=>{a(document.body).ready(e)}}}(jQuery),window.tsfinstaller.load();
